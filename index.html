<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Fun with Gifs</title>
		<link rel="stylesheet" type="text/css" href="assets/css/style.css">
		<!-- Bootstrap CDN-->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
		<script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

	</head>
	<body>
		<div class="container">
			<div class="jumbotron" id="topbox">
 				<h1>Rock Paper Scissor</h1>
 				<img src="assets/images/rpg.png" height="100px">
 			</div>
 			<img src="assets/images/rock.png" height="300px" onclick="rock()" >
 			<img src="assets/images/paper.png" height="300px" onclick="paper()" >
 			<img src="assets/images/scissor.png" height="300px" onclick="scissor()"><br>
 			<span id="msg">
  			<button type="button" class="btn btn-primary btn-lg btn-block" onclick="play()">Play Rock Paper Scissor</button>
  			</span><br>
  			
  			<span id="clicked"></span>
  		</div>
  		<span id="rpsimage"></span>

<script src='http://code.jquery.com/jquery-2.1.3.min.js'></script>
<script>
var config = {
    apiKey: "AIzaSyAOsy3xDNKEghTJprQVGk6KB-b8sPNF1ec",
    authDomain: "rpsgame-e4edf.firebaseapp.com",
    databaseURL: "https://rpsgame-e4edf.firebaseio.com",
    storageBucket: "rpsgame-e4edf.appspot.com",
  };
  firebase.initializeApp(config);
 var database = firebase.database();
 
	function play()
	{

		beginGame=1;
		startGame();
		
	}
	function startGame()
	{
		var player=0;
		if (beginGame)
		{
			database.ref().once("value", function(snapshot) {
				if ( snapshot.val().player1.flag == 0 )
				{
					$('#msg').html(" You are player1");
					database.ref().update({
					 	player1:{
					 	flag:1,
					 	score:0,
					 	choice:""
					 	}
					 });
					player=1;
				}
				if (( snapshot.val().player2.flag == 0 ) && (snapshot.val().player1.flag == 1))
				{
					$('#msg').html(" You are player2")
					database.ref().update({
					 	player2:{
					 	flag:1,
					 	score:0,
					 	choice:""
					 	}
					 });
					player=2;
				}
				if (( snapshot.val().player2.flag == 1 ) && (snapshot.val().player1.flag == 1))
				{
					$('#msg').html(" Game in Progress, please wait for your turn !!!")
				}
				if ( player === 1 )
				{
					database.ref().onDisconnect().update({
						 	player1:{
						 	flag:0,
						 	score:0,
						 	choice:""
						 	}
						 });
					sessionStorage.setItem('player', '1');
				}
				if ( player === 2 )
				{
					database.ref().onDisconnect().update({
						 	player2:{
						 	flag:0,
						 	score:0,
						 	choice:""
						 	}
						 });
					sessionStorage.setItem('player', '2');
				}

			});
		}
	}

		function rock()
		{
			var player = sessionStorage.getItem('player');
			if ( player == 1)
			{
				database.ref().once("value", function(snapshot) {
					var oldflg = snapshot.val().player1.flag;
					var oldscr = snapshot.val().player1.score;
					database.ref().update({
						 	player1:{
						 	flag:oldflg,
						 	score:oldscr,
						 	choice:"rock"
						 	}
						 });
				});
			}
			if ( player == 2)
			{
				database.ref().once("value", function(snapshot) {
					var oldflg = snapshot.val().player2.flag;
					var oldscr = snapshot.val().player2.score;
					database.ref().update({
						 	player2:{
						 	flag:oldflg,
						 	score:oldscr,
						 	choice:"rock"
						 	}
						 });
				});
			}
			$('#clicked').html("You clicked on rock")
		}
		function paper()
		{
		var player = sessionStorage.getItem('player');
			if ( player == 1)
			{
				database.ref().once("value", function(snapshot) {
					var oldflg = snapshot.val().player1.flag;
					var oldscr = snapshot.val().player1.score;
					database.ref().update({
						 	player1:{
						 	flag:oldflg,
						 	score:oldscr,
						 	choice:"paper"
						 	}
						 });
				});
			}
			if ( player == 2)
			{
				database.ref().once("value", function(snapshot) {
					var oldflg = snapshot.val().player2.flag;
					var oldscr = snapshot.val().player2.score;
					database.ref().update({
						 	player2:{
						 	flag:oldflg,
						 	score:oldscr,
						 	choice:"paper"
						 	}
						 });
				});
			}
			$('#clicked').html("You clicked on paper")
		}
		function scissor()
		{
			var player = sessionStorage.getItem('player');
			if ( player == 1)
			{
				database.ref().once("value", function(snapshot) {
					var oldflg = snapshot.val().player1.flag;
					var oldscr = snapshot.val().player1.score;
					database.ref().update({
						 	player1:{
						 	flag:oldflg,
						 	score:oldscr,
						 	choice:"scissor"
						 	}
						 });
				});
			}
			if ( player == 2)
			{
				database.ref().once("value", function(snapshot) {
					var oldflg = snapshot.val().player2.flag;
					var oldscr = snapshot.val().player2.score;
					database.ref().update({
						 	player2:{
						 	flag:oldflg,
						 	score:oldscr,
						 	choice:"scissor"
						 	}
						 });
				});
			}
			$('#clicked').html("You clicked on scissor")
		}
		function calculateWinner()
		{

		}
</script>
</body>
</html>
